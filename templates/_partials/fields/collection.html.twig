{% extends '@bolt/_partials/fields/_base.html.twig' %}
{% import '@bolt/_macro/_macro.html.twig' as macro %}

{% block field %}
    {% set labels = {
        'add_collection_item': 'collection.add_item'|trans({'%name%': field.definition.label}),
        'expand_all': 'collection.expand_all'|trans,
        'collapse_all': 'collection.collapse_all'|trans,
        'field_label': label,
        'select': 'collection.select'|trans,
        'collection_up': 'collection.move_item_up'|trans,
        'collection_down': 'collection.move_item_down'|trans,
        'collection_delete': 'collection.remove_item'|trans,
        'collection_delete_confirm': 'collection.confirm_delete'|trans
    } %}
    {% set limit = field.definition.get('limit')|default(200) %}

    {# get the html for all collection field already in the database #}
    {% set existing_fields %}{{ macro.generate_collection_fields(field, field.value, record, false) }}{% endset %}

    {% if variant == 'normal' %}
        {% set variant = field.definition.get('default_state')|default('collapsed') %}
    {% endif %}

    <editor-collection
      :existing-fields='{{ existing_fields }}'
      :fields='{{ field.definition.fields }}'
      :labels='{{ labels | json_encode }}'
      :limit='{{ limit | json_encode }}'
      :name="{{  field.name | json_encode }}"
      :variant="{{ variant|json_encode }}"
    ></editor-collection>

{% endblock %}
